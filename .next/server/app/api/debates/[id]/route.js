/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/debates/[id]/route";
exports.ids = ["app/api/debates/[id]/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebates%2F%5Bid%5D%2Froute.ts&appDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebates%2F%5Bid%5D%2Froute.ts&appDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_webDev_Projects_live_ai_debate_arena_Incomplete_src_app_api_debates_id_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/debates/[id]/route.ts */ \"(rsc)/./src/app/api/debates/[id]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/debates/[id]/route\",\n        pathname: \"/api/debates/[id]\",\n        filename: \"route\",\n        bundlePath: \"app/api/debates/[id]/route\"\n    },\n    resolvedPagePath: \"D:\\\\webDev Projects\\\\live-ai-debate-arena(Incomplete)\\\\src\\\\app\\\\api\\\\debates\\\\[id]\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_webDev_Projects_live_ai_debate_arena_Incomplete_src_app_api_debates_id_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZkZWJhdGVzJTJGJTVCaWQlNUQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmRlYmF0ZXMlMkYlNUJpZCU1RCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmRlYmF0ZXMlMkYlNUJpZCU1RCUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDd2ViRGV2JTIwUHJvamVjdHMlNUNsaXZlLWFpLWRlYmF0ZS1hcmVuYShJbmNvbXBsZXRlKSU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9RCUzQSU1Q3dlYkRldiUyMFByb2plY3RzJTVDbGl2ZS1haS1kZWJhdGUtYXJlbmEoSW5jb21wbGV0ZSkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQzZDO0FBQzFIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzBGOztBQUUxRiIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJEOlxcXFx3ZWJEZXYgUHJvamVjdHNcXFxcbGl2ZS1haS1kZWJhdGUtYXJlbmEoSW5jb21wbGV0ZSlcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZGViYXRlc1xcXFxbaWRdXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kZWJhdGVzL1tpZF0vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kZWJhdGVzL1tpZF1cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2RlYmF0ZXMvW2lkXS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkQ6XFxcXHdlYkRldiBQcm9qZWN0c1xcXFxsaXZlLWFpLWRlYmF0ZS1hcmVuYShJbmNvbXBsZXRlKVxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxkZWJhdGVzXFxcXFtpZF1cXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebates%2F%5Bid%5D%2Froute.ts&appDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/debates/[id]/route.ts":
/*!*******************************************!*\
  !*** ./src/app/api/debates/[id]/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   PATCH: () => (/* binding */ PATCH),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n\nasync function GET(request, { params }) {\n    try {\n        const debate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.findUnique({\n            where: {\n                id: params.id\n            },\n            include: {\n                proUser: true,\n                conUser: true,\n                creator: true,\n                messages: {\n                    orderBy: {\n                        createdAt: \"asc\"\n                    },\n                    include: {\n                        sender: true\n                    }\n                }\n            }\n        });\n        if (!debate) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Debate not found\"\n            }, {\n                status: 404\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(debate);\n    } catch (error) {\n        console.error(\"Error fetching debate:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(request, { params }) {\n    let userId;\n    let action;\n    try {\n        const body = await request.json();\n        userId = body.userId;\n        action = body.action;\n        const { joinCode } = body;\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findUnique({\n            where: {\n                clerkId: userId\n            }\n        });\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User not found\"\n            }, {\n                status: 404\n            });\n        }\n        const debate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.findUnique({\n            where: {\n                id: params.id\n            }\n        });\n        if (!debate) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Debate not found\"\n            }, {\n                status: 404\n            });\n        }\n        let updatedDebate;\n        if (action === \"join_con\") {\n            if (debate.status !== \"waiting\") {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Cannot join: Debate is not open for joining.\"\n                }, {\n                    status: 400\n                });\n            }\n            if (debate.proUserId === user.id || debate.conUserId === user.id) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"You are already a participant in this debate.\"\n                }, {\n                    status: 400\n                });\n            }\n            if (!joinCode || joinCode !== debate.joinCodeCon) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid join code for Con position\"\n                }, {\n                    status: 400\n                });\n            }\n            if (debate.conUserId) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Con position already taken\"\n                }, {\n                    status: 400\n                });\n            }\n            updatedDebate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.update({\n                where: {\n                    id: params.id\n                },\n                data: {\n                    conUserId: user.id,\n                    status: debate.proUserId ? \"in-progress\" : \"waiting\"\n                },\n                include: {\n                    proUser: true,\n                    conUser: true,\n                    creator: true\n                }\n            });\n        } else if (action === \"end\") {\n            if (debate.status === \"completed\") {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Debate is already completed.\"\n                }, {\n                    status: 400\n                });\n            }\n            // Only allow pro, con, or creator to end the debate\n            const allowedUserIds = [\n                debate.proUserId,\n                debate.conUserId,\n                debate.creatorId\n            ];\n            if (!allowedUserIds.includes(user.id)) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"You are not authorized to end this debate.\"\n                }, {\n                    status: 403\n                });\n            }\n            // Require at least 4 messages before scoring\n            const messageCount = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.count({\n                where: {\n                    debateId: debate.id\n                }\n            });\n            if (messageCount < 4) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Debate must have at least 4 messages before it can be ended and scored.\"\n                }, {\n                    status: 400\n                });\n            }\n            updatedDebate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.update({\n                where: {\n                    id: params.id\n                },\n                data: {\n                    status: \"completed\"\n                },\n                include: {\n                    proUser: true,\n                    conUser: true,\n                    creator: true,\n                    messages: {\n                        orderBy: {\n                            createdAt: \"asc\"\n                        },\n                        include: {\n                            sender: true\n                        }\n                    }\n                }\n            });\n            if (updatedDebate.proUser && updatedDebate.conUser) {\n                const existingScores = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.score.findMany({\n                    where: {\n                        debateId: updatedDebate.id,\n                        userId: {\n                            in: [\n                                updatedDebate.proUser.id,\n                                updatedDebate.conUser.id\n                            ]\n                        }\n                    }\n                });\n                const scoredUserIds = existingScores.map((s)=>s.userId);\n                // Build transcript for AI\n                const transcript = updatedDebate.messages.map((msg)=>`${msg.sender.username} (${msg.role}): ${msg.content}`).join(\"\\n\");\n                const debateTopic = updatedDebate.topic;\n                let aiScores = null;\n                try {\n                    const prompt = `\\n    Analyze this debate transcript and provide detailed feedback on both participants' performance.\\n    \\n    Debate Topic: ${debateTopic}\\n    \\n    Transcript:\\n    ${transcript}\\n    \\n    Provide feedback in the following format for each participant:\\n    1. Argument Structure (1-10): Score and detailed analysis\\n    2. Logical Consistency (1-10): Score and detailed analysis\\n    3. Persuasiveness (1-10): Score and detailed analysis\\n    4. Tone and Delivery (1-10): Score and detailed analysis\\n    5. Overall Effectiveness (1-10): Score and summary\\n    \\n    Also provide 3 specific suggestions for improvement for each participant.\\n    `;\n                    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n                        method: \"POST\",\n                        headers: {\n                            \"Authorization\": `Bearer ${process.env.OPENROUTER_API_KEY}`,\n                            \"Content-Type\": \"application/json\"\n                        },\n                        body: JSON.stringify({\n                            model: \"openai/gpt-4\",\n                            messages: [\n                                {\n                                    role: \"user\",\n                                    content: prompt\n                                }\n                            ],\n                            temperature: 0.7,\n                            max_tokens: 1500\n                        })\n                    });\n                    const data = await response.json();\n                    const analysis = data.choices?.[0]?.message?.content;\n                    // Parse scores for pro and con from analysis (simple regex-based extraction)\n                    if (analysis) {\n                        aiScores = {\n                            pro: {},\n                            con: {}\n                        };\n                        // Try to extract scores for each participant\n                        const proMatch = analysis.match(/pro.*?(\\d{1,2})[^\\d]+(\\d{1,2})[^\\d]+(\\d{1,2})[^\\d]+(\\d{1,2})/i);\n                        const conMatch = analysis.match(/con.*?(\\d{1,2})[^\\d]+(\\d{1,2})[^\\d]+(\\d{1,2})[^\\d]+(\\d{1,2})/i);\n                        // Fallback: try to extract all numbers in order\n                        const allScores = Array.from(analysis.matchAll(/(\\d{1,2})/g)).map((m)=>parseInt(m[1]));\n                        if (proMatch && proMatch.length >= 5) {\n                            aiScores.pro = {\n                                logic: Number(proMatch[1]),\n                                clarity: Number(proMatch[2]),\n                                persuasiveness: Number(proMatch[3]),\n                                tone: Number(proMatch[4])\n                            };\n                        } else if (allScores.length >= 4) {\n                            aiScores.pro = {\n                                logic: allScores[0],\n                                clarity: allScores[1],\n                                persuasiveness: allScores[2],\n                                tone: allScores[3]\n                            };\n                        }\n                        if (conMatch && conMatch.length >= 5) {\n                            aiScores.con = {\n                                logic: Number(conMatch[1]),\n                                clarity: Number(conMatch[2]),\n                                persuasiveness: Number(conMatch[3]),\n                                tone: Number(conMatch[4])\n                            };\n                        } else if (allScores.length >= 8) {\n                            aiScores.con = {\n                                logic: allScores[4],\n                                clarity: allScores[5],\n                                persuasiveness: allScores[6],\n                                tone: allScores[7]\n                            };\n                        }\n                    }\n                } catch (err) {\n                    // Fallback to static scores if AI fails\n                    aiScores = null;\n                }\n                // Save scores for pro and con\n                const proScore = aiScores?.pro || {\n                    logic: 7,\n                    clarity: 8,\n                    persuasiveness: 7,\n                    tone: 8\n                };\n                const conScore = aiScores?.con || {\n                    logic: 7,\n                    clarity: 8,\n                    persuasiveness: 7,\n                    tone: 8\n                };\n                if (!scoredUserIds.includes(updatedDebate.proUser.id)) {\n                    await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.score.create({\n                        data: {\n                            ...proScore,\n                            userId: updatedDebate.proUser.id,\n                            debateId: updatedDebate.id\n                        }\n                    });\n                }\n                if (!scoredUserIds.includes(updatedDebate.conUser.id)) {\n                    await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.score.create({\n                        data: {\n                            ...conScore,\n                            userId: updatedDebate.conUser.id,\n                            debateId: updatedDebate.id\n                        }\n                    });\n                }\n            }\n        } else {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid action\"\n            }, {\n                status: 400\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(updatedDebate);\n    } catch (error) {\n        console.error(\"Error updating debate:\", {\n            error,\n            userId,\n            debateId: params.id,\n            action\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function DELETE(request, { params }) {\n    try {\n        const { userId } = await request.json();\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findUnique({\n            where: {\n                clerkId: userId\n            }\n        });\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User not found\"\n            }, {\n                status: 404\n            });\n        }\n        const debate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.findUnique({\n            where: {\n                id: params.id\n            },\n            include: {\n                proUser: true,\n                conUser: true,\n                creator: true\n            }\n        });\n        if (!debate) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Debate not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Only allow the debate creator (pro user) to delete\n        if (debate.proUserId !== user.id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Only the debate creator can delete this debate\"\n            }, {\n                status: 403\n            });\n        }\n        // Delete related data first (cascade delete)\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.$transaction([\n            // Delete messages\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.deleteMany({\n                where: {\n                    debateId: params.id\n                }\n            }),\n            // Delete scores\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.score.deleteMany({\n                where: {\n                    debateId: params.id\n                }\n            }),\n            // Delete votes\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.vote.deleteMany({\n                where: {\n                    debateId: params.id\n                }\n            }),\n            // Delete the debate\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.delete({\n                where: {\n                    id: params.id\n                }\n            })\n        ]);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true\n        });\n    } catch (error) {\n        console.error(\"Error deleting debate:\", {\n            error,\n            debateId: params.id\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function PATCH(request, { params }) {\n    let userId;\n    let action;\n    try {\n        const body = await request.json();\n        userId = body.userId;\n        action = body.action;\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findUnique({\n            where: {\n                clerkId: userId\n            }\n        });\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User not found\"\n            }, {\n                status: 404\n            });\n        }\n        const debate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.findUnique({\n            where: {\n                id: params.id\n            },\n            include: {\n                proUser: true,\n                conUser: true,\n                creator: true\n            }\n        });\n        if (!debate) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Debate not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Only allow debate creator to remove participants\n        if (debate.proUserId !== user.id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Only the debate creator can remove participants\"\n            }, {\n                status: 403\n            });\n        }\n        let updatedDebate;\n        if (action === \"remove_pro\") {\n            if (!debate.proUser) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"No Pro participant to remove\"\n                }, {\n                    status: 400\n                });\n            }\n            // Cannot remove pro user as they are the creator and required\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Cannot remove the Pro participant as they are the debate creator\"\n            }, {\n                status: 400\n            });\n        } else if (action === \"remove_con\") {\n            if (!debate.conUser) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"No Con participant to remove\"\n                }, {\n                    status: 400\n                });\n            }\n            updatedDebate = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.debate.update({\n                where: {\n                    id: params.id\n                },\n                data: {\n                    conUserId: null,\n                    status: \"waiting\"\n                },\n                include: {\n                    proUser: true,\n                    conUser: true,\n                    creator: true\n                }\n            });\n        } else {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid action\"\n            }, {\n                status: 400\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(updatedDebate);\n    } catch (error) {\n        console.error(\"Error updating debate:\", {\n            error,\n            userId,\n            debateId: params.id,\n            action\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function OPTIONS() {\n    return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, {\n        headers: {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'GET, POST, PATCH, DELETE, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type, Authorization'\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNQSxDQUFDSSxNQUFNLENBQUMyQixNQUFNLENBQUM7Z0JBQ3pDekIsT0FBTztvQkFBRUMsSUFBSUosT0FBT0ksRUFBRTtnQkFBQztnQkFDdkJ5QixNQUFNO29CQUNKSCxXQUFXO29CQUNYWCxRQUFRO2dCQUNWO2dCQUNBVixTQUFTO29CQUNQQyxTQUFTO29CQUNUQyxTQUFTO29CQUNUQyxTQUFTO2dCQUNYO1lBQ0Y7UUFDRixPQUFPO1lBQ0wsT0FBT1oscURBQVlBLENBQUNpQixJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBaUIsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ3RFO1FBRUEsT0FBT25CLHFEQUFZQSxDQUFDaUIsSUFBSSxDQUFDVztJQUMzQixFQUFFLE9BQU9WLE9BQU87UUFDZEUsUUFBUUYsS0FBSyxDQUFDLDBCQUEwQjtZQUFFQTtZQUFPSTtZQUFRa0IsVUFBVXBDLE9BQU9JLEVBQUU7WUFBRWU7UUFBTztRQUNyRixPQUFPdkIscURBQVlBLENBQUNpQixJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBd0IsR0FDakM7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0Y7QUFFTyxlQUFlaUY7SUFDcEIsT0FBTyxJQUFJcEcscURBQVlBLENBQUMsTUFBTTtRQUM1QjZELFNBQVM7WUFDUCwrQkFBK0I7WUFDL0IsZ0NBQWdDO1lBQ2hDLGdDQUFnQztRQUNsQztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIkQ6XFx3ZWJEZXYgUHJvamVjdHNcXGxpdmUtYWktZGViYXRlLWFyZW5hKEluY29tcGxldGUpXFxzcmNcXGFwcFxcYXBpXFxkZWJhdGVzXFxbaWRdXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChcclxuICByZXF1ZXN0OiBSZXF1ZXN0LFxyXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IGlkOiBzdHJpbmcgfSB9XHJcbikge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkZWJhdGUgPSBhd2FpdCBwcmlzbWEuZGViYXRlLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogcGFyYW1zLmlkIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBwcm9Vc2VyOiB0cnVlLFxyXG4gICAgICAgIGNvblVzZXI6IHRydWUsXHJcbiAgICAgICAgY3JlYXRvcjogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlczoge1xyXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiYXNjXCIgfSxcclxuICAgICAgICAgIGluY2x1ZGU6IHsgc2VuZGVyOiB0cnVlIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghZGViYXRlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkRlYmF0ZSBub3QgZm91bmRcIiB9LCB7IHN0YXR1czogNDA0IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihkZWJhdGUpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgZGViYXRlOlwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QoXHJcbiAgcmVxdWVzdDogUmVxdWVzdCxcclxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyBpZDogc3RyaW5nIH0gfVxyXG4pIHtcclxuICBsZXQgdXNlcklkOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgbGV0IGFjdGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICB1c2VySWQgPSBib2R5LnVzZXJJZDtcclxuICAgIGFjdGlvbiA9IGJvZHkuYWN0aW9uO1xyXG4gICAgY29uc3QgeyBqb2luQ29kZSB9ID0gYm9keTtcclxuXHJcbiAgICBpZiAoIXVzZXJJZCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHsgXHJcbiAgICAgIHdoZXJlOiB7IGNsZXJrSWQ6IHVzZXJJZCB9IFxyXG4gICAgfSk7XHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVXNlciBub3QgZm91bmRcIiB9LCB7IHN0YXR1czogNDA0IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRlYmF0ZSA9IGF3YWl0IHByaXNtYS5kZWJhdGUuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiBwYXJhbXMuaWQgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFkZWJhdGUpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRGViYXRlIG5vdCBmb3VuZFwiIH0sIHsgc3RhdHVzOiA0MDQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHVwZGF0ZWREZWJhdGU7XHJcblxyXG4gICAgaWYgKGFjdGlvbiA9PT0gXCJqb2luX2NvblwiKSB7XHJcbiAgICAgIGlmIChkZWJhdGUuc3RhdHVzICE9PSBcIndhaXRpbmdcIikge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6IFwiQ2Fubm90IGpvaW46IERlYmF0ZSBpcyBub3Qgb3BlbiBmb3Igam9pbmluZy5cIiB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZGViYXRlLnByb1VzZXJJZCA9PT0gdXNlci5pZCB8fCBkZWJhdGUuY29uVXNlcklkID09PSB1c2VyLmlkKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogXCJZb3UgYXJlIGFscmVhZHkgYSBwYXJ0aWNpcGFudCBpbiB0aGlzIGRlYmF0ZS5cIiB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIWpvaW5Db2RlIHx8IGpvaW5Db2RlICE9PSBkZWJhdGUuam9pbkNvZGVDb24pIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiBcIkludmFsaWQgam9pbiBjb2RlIGZvciBDb24gcG9zaXRpb25cIiB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZGViYXRlLmNvblVzZXJJZCkge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6IFwiQ29uIHBvc2l0aW9uIGFscmVhZHkgdGFrZW5cIiB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkRGViYXRlID0gYXdhaXQgcHJpc21hLmRlYmF0ZS51cGRhdGUoe1xyXG4gICAgICAgIHdoZXJlOiB7IGlkOiBwYXJhbXMuaWQgfSxcclxuICAgICAgICBkYXRhOiB7IFxyXG4gICAgICAgICAgY29uVXNlcklkOiB1c2VyLmlkLFxyXG4gICAgICAgICAgc3RhdHVzOiBkZWJhdGUucHJvVXNlcklkID8gXCJpbi1wcm9ncmVzc1wiIDogXCJ3YWl0aW5nXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgIHByb1VzZXI6IHRydWUsXHJcbiAgICAgICAgICBjb25Vc2VyOiB0cnVlLFxyXG4gICAgICAgICAgY3JlYXRvcjogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJlbmRcIikge1xyXG4gICAgICBpZiAoZGViYXRlLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIikge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkRlYmF0ZSBpcyBhbHJlYWR5IGNvbXBsZXRlZC5cIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIE9ubHkgYWxsb3cgcHJvLCBjb24sIG9yIGNyZWF0b3IgdG8gZW5kIHRoZSBkZWJhdGVcclxuICAgICAgY29uc3QgYWxsb3dlZFVzZXJJZHMgPSBbZGViYXRlLnByb1VzZXJJZCwgZGViYXRlLmNvblVzZXJJZCwgZGViYXRlLmNyZWF0b3JJZF07XHJcbiAgICAgIGlmICghYWxsb3dlZFVzZXJJZHMuaW5jbHVkZXModXNlci5pZCkpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGVuZCB0aGlzIGRlYmF0ZS5cIiB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIFJlcXVpcmUgYXQgbGVhc3QgNCBtZXNzYWdlcyBiZWZvcmUgc2NvcmluZ1xyXG4gICAgICBjb25zdCBtZXNzYWdlQ291bnQgPSBhd2FpdCBwcmlzbWEubWVzc2FnZS5jb3VudCh7IHdoZXJlOiB7IGRlYmF0ZUlkOiBkZWJhdGUuaWQgfSB9KTtcclxuICAgICAgaWYgKG1lc3NhZ2VDb3VudCA8IDQpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJEZWJhdGUgbXVzdCBoYXZlIGF0IGxlYXN0IDQgbWVzc2FnZXMgYmVmb3JlIGl0IGNhbiBiZSBlbmRlZCBhbmQgc2NvcmVkLlwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZERlYmF0ZSA9IGF3YWl0IHByaXNtYS5kZWJhdGUudXBkYXRlKHtcclxuICAgICAgICB3aGVyZTogeyBpZDogcGFyYW1zLmlkIH0sXHJcbiAgICAgICAgZGF0YTogeyBzdGF0dXM6IFwiY29tcGxldGVkXCIgfSxcclxuICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICBwcm9Vc2VyOiB0cnVlLFxyXG4gICAgICAgICAgY29uVXNlcjogdHJ1ZSxcclxuICAgICAgICAgIGNyZWF0b3I6IHRydWUsXHJcbiAgICAgICAgICBtZXNzYWdlczoge1xyXG4gICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJhc2NcIiB9LFxyXG4gICAgICAgICAgICBpbmNsdWRlOiB7IHNlbmRlcjogdHJ1ZSB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgaWYgKHVwZGF0ZWREZWJhdGUucHJvVXNlciAmJiB1cGRhdGVkRGViYXRlLmNvblVzZXIpIHtcclxuICAgICAgICBjb25zdCBleGlzdGluZ1Njb3JlcyA9IGF3YWl0IHByaXNtYS5zY29yZS5maW5kTWFueSh7XHJcbiAgICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgICBkZWJhdGVJZDogdXBkYXRlZERlYmF0ZS5pZCxcclxuICAgICAgICAgICAgdXNlcklkOiB7IGluOiBbdXBkYXRlZERlYmF0ZS5wcm9Vc2VyLmlkLCB1cGRhdGVkRGViYXRlLmNvblVzZXIuaWRdIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBzY29yZWRVc2VySWRzID0gZXhpc3RpbmdTY29yZXMubWFwKHMgPT4gcy51c2VySWQpO1xyXG4gICAgICAgIC8vIEJ1aWxkIHRyYW5zY3JpcHQgZm9yIEFJXHJcbiAgICAgICAgY29uc3QgdHJhbnNjcmlwdCA9IHVwZGF0ZWREZWJhdGUubWVzc2FnZXNcclxuICAgICAgICAgIC5tYXAoKG1zZzogYW55KSA9PiBgJHttc2cuc2VuZGVyLnVzZXJuYW1lfSAoJHttc2cucm9sZX0pOiAke21zZy5jb250ZW50fWApXHJcbiAgICAgICAgICAuam9pbihcIlxcblwiKTtcclxuICAgICAgICBjb25zdCBkZWJhdGVUb3BpYyA9IHVwZGF0ZWREZWJhdGUudG9waWM7XHJcbiAgICAgICAgbGV0IGFpU2NvcmVzOiBhbnkgPSBudWxsO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBwcm9tcHQgPSBgXFxuICAgIEFuYWx5emUgdGhpcyBkZWJhdGUgdHJhbnNjcmlwdCBhbmQgcHJvdmlkZSBkZXRhaWxlZCBmZWVkYmFjayBvbiBib3RoIHBhcnRpY2lwYW50cycgcGVyZm9ybWFuY2UuXFxuICAgIFxcbiAgICBEZWJhdGUgVG9waWM6ICR7ZGViYXRlVG9waWN9XFxuICAgIFxcbiAgICBUcmFuc2NyaXB0OlxcbiAgICAke3RyYW5zY3JpcHR9XFxuICAgIFxcbiAgICBQcm92aWRlIGZlZWRiYWNrIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0IGZvciBlYWNoIHBhcnRpY2lwYW50OlxcbiAgICAxLiBBcmd1bWVudCBTdHJ1Y3R1cmUgKDEtMTApOiBTY29yZSBhbmQgZGV0YWlsZWQgYW5hbHlzaXNcXG4gICAgMi4gTG9naWNhbCBDb25zaXN0ZW5jeSAoMS0xMCk6IFNjb3JlIGFuZCBkZXRhaWxlZCBhbmFseXNpc1xcbiAgICAzLiBQZXJzdWFzaXZlbmVzcyAoMS0xMCk6IFNjb3JlIGFuZCBkZXRhaWxlZCBhbmFseXNpc1xcbiAgICA0LiBUb25lIGFuZCBEZWxpdmVyeSAoMS0xMCk6IFNjb3JlIGFuZCBkZXRhaWxlZCBhbmFseXNpc1xcbiAgICA1LiBPdmVyYWxsIEVmZmVjdGl2ZW5lc3MgKDEtMTApOiBTY29yZSBhbmQgc3VtbWFyeVxcbiAgICBcXG4gICAgQWxzbyBwcm92aWRlIDMgc3BlY2lmaWMgc3VnZ2VzdGlvbnMgZm9yIGltcHJvdmVtZW50IGZvciBlYWNoIHBhcnRpY2lwYW50LlxcbiAgICBgO1xyXG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vb3BlbnJvdXRlci5haS9hcGkvdjEvY2hhdC9jb21wbGV0aW9uc1wiLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICBcIkF1dGhvcml6YXRpb25cIjogYEJlYXJlciAke3Byb2Nlc3MuZW52Lk9QRU5ST1VURVJfQVBJX0tFWX1gLFxyXG4gICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICBtb2RlbDogXCJvcGVuYWkvZ3B0LTRcIixcclxuICAgICAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHByb21wdCB9XSxcclxuICAgICAgICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxyXG4gICAgICAgICAgICAgIG1heF90b2tlbnM6IDE1MDBcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgIGNvbnN0IGFuYWx5c2lzID0gZGF0YS5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQ7XHJcbiAgICAgICAgICAvLyBQYXJzZSBzY29yZXMgZm9yIHBybyBhbmQgY29uIGZyb20gYW5hbHlzaXMgKHNpbXBsZSByZWdleC1iYXNlZCBleHRyYWN0aW9uKVxyXG4gICAgICAgICAgaWYgKGFuYWx5c2lzKSB7XHJcbiAgICAgICAgICAgIGFpU2NvcmVzID0geyBwcm86IHt9LCBjb246IHt9IH07XHJcbiAgICAgICAgICAgIC8vIFRyeSB0byBleHRyYWN0IHNjb3JlcyBmb3IgZWFjaCBwYXJ0aWNpcGFudFxyXG4gICAgICAgICAgICBjb25zdCBwcm9NYXRjaCA9IGFuYWx5c2lzLm1hdGNoKC9wcm8uKj8oXFxkezEsMn0pW15cXGRdKyhcXGR7MSwyfSlbXlxcZF0rKFxcZHsxLDJ9KVteXFxkXSsoXFxkezEsMn0pL2kpO1xyXG4gICAgICAgICAgICBjb25zdCBjb25NYXRjaCA9IGFuYWx5c2lzLm1hdGNoKC9jb24uKj8oXFxkezEsMn0pW15cXGRdKyhcXGR7MSwyfSlbXlxcZF0rKFxcZHsxLDJ9KVteXFxkXSsoXFxkezEsMn0pL2kpO1xyXG4gICAgICAgICAgICAvLyBGYWxsYmFjazogdHJ5IHRvIGV4dHJhY3QgYWxsIG51bWJlcnMgaW4gb3JkZXJcclxuICAgICAgICAgICAgY29uc3QgYWxsU2NvcmVzID0gQXJyYXkuZnJvbShhbmFseXNpcy5tYXRjaEFsbCgvKFxcZHsxLDJ9KS9nKSkubWFwKChtOiBhbnkpID0+IHBhcnNlSW50KG1bMV0pKTtcclxuICAgICAgICAgICAgaWYgKHByb01hdGNoICYmIHByb01hdGNoLmxlbmd0aCA+PSA1KSB7XHJcbiAgICAgICAgICAgICAgYWlTY29yZXMucHJvID0ge1xyXG4gICAgICAgICAgICAgICAgbG9naWM6IE51bWJlcihwcm9NYXRjaFsxXSksXHJcbiAgICAgICAgICAgICAgICBjbGFyaXR5OiBOdW1iZXIocHJvTWF0Y2hbMl0pLFxyXG4gICAgICAgICAgICAgICAgcGVyc3Vhc2l2ZW5lc3M6IE51bWJlcihwcm9NYXRjaFszXSksXHJcbiAgICAgICAgICAgICAgICB0b25lOiBOdW1iZXIocHJvTWF0Y2hbNF0pLFxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxsU2NvcmVzLmxlbmd0aCA+PSA0KSB7XHJcbiAgICAgICAgICAgICAgYWlTY29yZXMucHJvID0ge1xyXG4gICAgICAgICAgICAgICAgbG9naWM6IGFsbFNjb3Jlc1swXSxcclxuICAgICAgICAgICAgICAgIGNsYXJpdHk6IGFsbFNjb3Jlc1sxXSxcclxuICAgICAgICAgICAgICAgIHBlcnN1YXNpdmVuZXNzOiBhbGxTY29yZXNbMl0sXHJcbiAgICAgICAgICAgICAgICB0b25lOiBhbGxTY29yZXNbM10sXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29uTWF0Y2ggJiYgY29uTWF0Y2gubGVuZ3RoID49IDUpIHtcclxuICAgICAgICAgICAgICBhaVNjb3Jlcy5jb24gPSB7XHJcbiAgICAgICAgICAgICAgICBsb2dpYzogTnVtYmVyKGNvbk1hdGNoWzFdKSxcclxuICAgICAgICAgICAgICAgIGNsYXJpdHk6IE51bWJlcihjb25NYXRjaFsyXSksXHJcbiAgICAgICAgICAgICAgICBwZXJzdWFzaXZlbmVzczogTnVtYmVyKGNvbk1hdGNoWzNdKSxcclxuICAgICAgICAgICAgICAgIHRvbmU6IE51bWJlcihjb25NYXRjaFs0XSksXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhbGxTY29yZXMubGVuZ3RoID49IDgpIHtcclxuICAgICAgICAgICAgICBhaVNjb3Jlcy5jb24gPSB7XHJcbiAgICAgICAgICAgICAgICBsb2dpYzogYWxsU2NvcmVzWzRdLFxyXG4gICAgICAgICAgICAgICAgY2xhcml0eTogYWxsU2NvcmVzWzVdLFxyXG4gICAgICAgICAgICAgICAgcGVyc3Vhc2l2ZW5lc3M6IGFsbFNjb3Jlc1s2XSxcclxuICAgICAgICAgICAgICAgIHRvbmU6IGFsbFNjb3Jlc1s3XSxcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAvLyBGYWxsYmFjayB0byBzdGF0aWMgc2NvcmVzIGlmIEFJIGZhaWxzXHJcbiAgICAgICAgICBhaVNjb3JlcyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFNhdmUgc2NvcmVzIGZvciBwcm8gYW5kIGNvblxyXG4gICAgICAgIGNvbnN0IHByb1Njb3JlID0gYWlTY29yZXM/LnBybyB8fCB7IGxvZ2ljOiA3LCBjbGFyaXR5OiA4LCBwZXJzdWFzaXZlbmVzczogNywgdG9uZTogOCB9O1xyXG4gICAgICAgIGNvbnN0IGNvblNjb3JlID0gYWlTY29yZXM/LmNvbiB8fCB7IGxvZ2ljOiA3LCBjbGFyaXR5OiA4LCBwZXJzdWFzaXZlbmVzczogNywgdG9uZTogOCB9O1xyXG4gICAgICAgIGlmICghc2NvcmVkVXNlcklkcy5pbmNsdWRlcyh1cGRhdGVkRGViYXRlLnByb1VzZXIuaWQpKSB7XHJcbiAgICAgICAgICBhd2FpdCBwcmlzbWEuc2NvcmUuY3JlYXRlKHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgIC4uLnByb1Njb3JlLFxyXG4gICAgICAgICAgICAgIHVzZXJJZDogdXBkYXRlZERlYmF0ZS5wcm9Vc2VyLmlkLFxyXG4gICAgICAgICAgICAgIGRlYmF0ZUlkOiB1cGRhdGVkRGViYXRlLmlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXNjb3JlZFVzZXJJZHMuaW5jbHVkZXModXBkYXRlZERlYmF0ZS5jb25Vc2VyLmlkKSkge1xyXG4gICAgICAgICAgYXdhaXQgcHJpc21hLnNjb3JlLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAuLi5jb25TY29yZSxcclxuICAgICAgICAgICAgICB1c2VySWQ6IHVwZGF0ZWREZWJhdGUuY29uVXNlci5pZCxcclxuICAgICAgICAgICAgICBkZWJhdGVJZDogdXBkYXRlZERlYmF0ZS5pZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkludmFsaWQgYWN0aW9uXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24odXBkYXRlZERlYmF0ZSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBkZWJhdGU6XCIsIHsgZXJyb3IsIHVzZXJJZCwgZGViYXRlSWQ6IHBhcmFtcy5pZCwgYWN0aW9uIH0pO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUoXHJcbiAgcmVxdWVzdDogUmVxdWVzdCxcclxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyBpZDogc3RyaW5nIH0gfVxyXG4pIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB1c2VySWQgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG5cclxuICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyBcclxuICAgICAgd2hlcmU6IHsgY2xlcmtJZDogdXNlcklkIH0gXHJcbiAgICB9KTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJVc2VyIG5vdCBmb3VuZFwiIH0sIHsgc3RhdHVzOiA0MDQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGViYXRlID0gYXdhaXQgcHJpc21hLmRlYmF0ZS5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IHBhcmFtcy5pZCB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgcHJvVXNlcjogdHJ1ZSxcclxuICAgICAgICBjb25Vc2VyOiB0cnVlLFxyXG4gICAgICAgIGNyZWF0b3I6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFkZWJhdGUpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRGViYXRlIG5vdCBmb3VuZFwiIH0sIHsgc3RhdHVzOiA0MDQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT25seSBhbGxvdyB0aGUgZGViYXRlIGNyZWF0b3IgKHBybyB1c2VyKSB0byBkZWxldGVcclxuICAgIGlmIChkZWJhdGUucHJvVXNlcklkICE9PSB1c2VyLmlkKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIk9ubHkgdGhlIGRlYmF0ZSBjcmVhdG9yIGNhbiBkZWxldGUgdGhpcyBkZWJhdGVcIiB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlbGV0ZSByZWxhdGVkIGRhdGEgZmlyc3QgKGNhc2NhZGUgZGVsZXRlKVxyXG4gICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihbXHJcbiAgICAgIC8vIERlbGV0ZSBtZXNzYWdlc1xyXG4gICAgICBwcmlzbWEubWVzc2FnZS5kZWxldGVNYW55KHtcclxuICAgICAgICB3aGVyZTogeyBkZWJhdGVJZDogcGFyYW1zLmlkIH1cclxuICAgICAgfSksXHJcbiAgICAgIC8vIERlbGV0ZSBzY29yZXNcclxuICAgICAgcHJpc21hLnNjb3JlLmRlbGV0ZU1hbnkoe1xyXG4gICAgICAgIHdoZXJlOiB7IGRlYmF0ZUlkOiBwYXJhbXMuaWQgfVxyXG4gICAgICB9KSxcclxuICAgICAgLy8gRGVsZXRlIHZvdGVzXHJcbiAgICAgIHByaXNtYS52b3RlLmRlbGV0ZU1hbnkoe1xyXG4gICAgICAgIHdoZXJlOiB7IGRlYmF0ZUlkOiBwYXJhbXMuaWQgfVxyXG4gICAgICB9KSxcclxuICAgICAgLy8gRGVsZXRlIHRoZSBkZWJhdGVcclxuICAgICAgcHJpc21hLmRlYmF0ZS5kZWxldGUoe1xyXG4gICAgICAgIHdoZXJlOiB7IGlkOiBwYXJhbXMuaWQgfVxyXG4gICAgICB9KVxyXG4gICAgXSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogdHJ1ZSB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGRlYmF0ZTpcIiwgeyBlcnJvciwgZGViYXRlSWQ6IHBhcmFtcy5pZCB9KTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIiB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUEFUQ0goXHJcbiAgcmVxdWVzdDogUmVxdWVzdCxcclxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyBpZDogc3RyaW5nIH0gfVxyXG4pIHtcclxuICBsZXQgdXNlcklkOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgbGV0IGFjdGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICB1c2VySWQgPSBib2R5LnVzZXJJZDtcclxuICAgIGFjdGlvbiA9IGJvZHkuYWN0aW9uO1xyXG5cclxuICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyBcclxuICAgICAgd2hlcmU6IHsgY2xlcmtJZDogdXNlcklkIH0gXHJcbiAgICB9KTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJVc2VyIG5vdCBmb3VuZFwiIH0sIHsgc3RhdHVzOiA0MDQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGViYXRlID0gYXdhaXQgcHJpc21hLmRlYmF0ZS5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IHBhcmFtcy5pZCB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgcHJvVXNlcjogdHJ1ZSxcclxuICAgICAgICBjb25Vc2VyOiB0cnVlLFxyXG4gICAgICAgIGNyZWF0b3I6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFkZWJhdGUpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRGViYXRlIG5vdCBmb3VuZFwiIH0sIHsgc3RhdHVzOiA0MDQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT25seSBhbGxvdyBkZWJhdGUgY3JlYXRvciB0byByZW1vdmUgcGFydGljaXBhbnRzXHJcbiAgICBpZiAoZGViYXRlLnByb1VzZXJJZCAhPT0gdXNlci5pZCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJPbmx5IHRoZSBkZWJhdGUgY3JlYXRvciBjYW4gcmVtb3ZlIHBhcnRpY2lwYW50c1wiIH0sIHsgc3RhdHVzOiA0MDMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHVwZGF0ZWREZWJhdGU7XHJcblxyXG4gICAgaWYgKGFjdGlvbiA9PT0gXCJyZW1vdmVfcHJvXCIpIHtcclxuICAgICAgaWYgKCFkZWJhdGUucHJvVXNlcikge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIk5vIFBybyBwYXJ0aWNpcGFudCB0byByZW1vdmVcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBDYW5ub3QgcmVtb3ZlIHBybyB1c2VyIGFzIHRoZXkgYXJlIHRoZSBjcmVhdG9yIGFuZCByZXF1aXJlZFxyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJDYW5ub3QgcmVtb3ZlIHRoZSBQcm8gcGFydGljaXBhbnQgYXMgdGhleSBhcmUgdGhlIGRlYmF0ZSBjcmVhdG9yXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSBcInJlbW92ZV9jb25cIikge1xyXG4gICAgICBpZiAoIWRlYmF0ZS5jb25Vc2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiTm8gQ29uIHBhcnRpY2lwYW50IHRvIHJlbW92ZVwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHVwZGF0ZWREZWJhdGUgPSBhd2FpdCBwcmlzbWEuZGViYXRlLnVwZGF0ZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHBhcmFtcy5pZCB9LFxyXG4gICAgICAgIGRhdGE6IHsgXHJcbiAgICAgICAgICBjb25Vc2VySWQ6IG51bGwsXHJcbiAgICAgICAgICBzdGF0dXM6IFwid2FpdGluZ1wiXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICBwcm9Vc2VyOiB0cnVlLFxyXG4gICAgICAgICAgY29uVXNlcjogdHJ1ZSxcclxuICAgICAgICAgIGNyZWF0b3I6IHRydWVcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCBhY3Rpb25cIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih1cGRhdGVkRGViYXRlKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIGRlYmF0ZTpcIiwgeyBlcnJvciwgdXNlcklkLCBkZWJhdGVJZDogcGFyYW1zLmlkLCBhY3Rpb24gfSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMoKSB7XHJcbiAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UobnVsbCwge1xyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonLFxyXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcyc6ICdHRVQsIFBPU1QsIFBBVENILCBERUxFVEUsIE9QVElPTlMnLFxyXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24nLFxyXG4gICAgfVxyXG4gIH0pO1xyXG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInByaXNtYSIsIkdFVCIsInJlcXVlc3QiLCJwYXJhbXMiLCJkZWJhdGUiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJpZCIsImluY2x1ZGUiLCJwcm9Vc2VyIiwiY29uVXNlciIsImNyZWF0b3IiLCJtZXNzYWdlcyIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJzZW5kZXIiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJjb25zb2xlIiwiUE9TVCIsInVzZXJJZCIsImFjdGlvbiIsImJvZHkiLCJqb2luQ29kZSIsInVzZXIiLCJjbGVya0lkIiwidXBkYXRlZERlYmF0ZSIsInByb1VzZXJJZCIsImNvblVzZXJJZCIsImpvaW5Db2RlQ29uIiwidXBkYXRlIiwiZGF0YSIsImFsbG93ZWRVc2VySWRzIiwiY3JlYXRvcklkIiwiaW5jbHVkZXMiLCJtZXNzYWdlQ291bnQiLCJtZXNzYWdlIiwiY291bnQiLCJkZWJhdGVJZCIsImV4aXN0aW5nU2NvcmVzIiwic2NvcmUiLCJmaW5kTWFueSIsImluIiwic2NvcmVkVXNlcklkcyIsIm1hcCIsInMiLCJ0cmFuc2NyaXB0IiwibXNnIiwidXNlcm5hbWUiLCJyb2xlIiwiY29udGVudCIsImpvaW4iLCJkZWJhdGVUb3BpYyIsInRvcGljIiwiYWlTY29yZXMiLCJwcm9tcHQiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsInByb2Nlc3MiLCJlbnYiLCJPUEVOUk9VVEVSX0FQSV9LRVkiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kZWwiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJhbmFseXNpcyIsImNob2ljZXMiLCJwcm8iLCJjb24iLCJwcm9NYXRjaCIsIm1hdGNoIiwiY29uTWF0Y2giLCJhbGxTY29yZXMiLCJBcnJheSIsImZyb20iLCJtYXRjaEFsbCIsIm0iLCJwYXJzZUludCIsImxlbmd0aCIsImxvZ2ljIiwiTnVtYmVyIiwiY2xhcml0eSIsInBlcnN1YXNpdmVuZXNzIiwidG9uZSIsImVyciIsInByb1Njb3JlIiwiY29uU2NvcmUiLCJjcmVhdGUiLCJERUxFVEUiLCIkdHJhbnNhY3Rpb24iLCJkZWxldGVNYW55Iiwidm90ZSIsImRlbGV0ZSIsInN1Y2Nlc3MiLCJQQVRDSCIsIk9QVElPTlMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/debates/[id]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log: [\n        \"query\"\n    ]\n});\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFFOUMsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUNYRixnQkFBZ0JFLE1BQU0sSUFDdEIsSUFBSUgsd0RBQVlBLENBQUM7SUFDZkksS0FBSztRQUFDO0tBQVE7QUFDaEIsR0FBRztBQUVMLElBQUlDLElBQXFDLEVBQUVKLGdCQUFnQkUsTUFBTSxHQUFHQSIsInNvdXJjZXMiOlsiRDpcXHdlYkRldiBQcm9qZWN0c1xcbGl2ZS1haS1kZWJhdGUtYXJlbmEoSW5jb21wbGV0ZSlcXHNyY1xcbGliXFxwcmlzbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XHJcblxyXG5jb25zdCBnbG9iYWxGb3JQcmlzbWEgPSBnbG9iYWxUaGlzIGFzIHVua25vd24gYXMge1xyXG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHByaXNtYSA9XHJcbiAgZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA/P1xyXG4gIG5ldyBQcmlzbWFDbGllbnQoe1xyXG4gICAgbG9nOiBbXCJxdWVyeVwiXSxcclxuICB9KTtcclxuXHJcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7Il0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsImdsb2JhbEZvclByaXNtYSIsImdsb2JhbFRoaXMiLCJwcmlzbWEiLCJsb2ciLCJwcm9jZXNzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fdebates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebates%2F%5Bid%5D%2Froute.ts&appDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CwebDev%20Projects%5Clive-ai-debate-arena(Incomplete)&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();